<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/security
		http://www.springframework.org/schema/security/spring-security-3.2.xsd
">

	<security:authentication-manager alias="authenticationManager">
		<security:authentication-provider ref="jdbcUsernamePasswordAuthenticationProvider" />
		<security:authentication-provider ref="jdbcKeyAuthenticationProvider" />
		<security:authentication-provider ref="jdbcTokenAuthenticationProvider" />
	</security:authentication-manager>
	
	
	<!-- ====== REST API Authentication ====== -->
	<bean id="restAPIAuthenticationEntryPoint" class="com.base22.carbon.authentication.AuthenticationEntryPoint" />
	<bean id="restAPIcorsProcessingFilter" class="com.base22.carbon.web.CORSProcessingFilter"></bean>
	<bean id="restAPIAuthenticationProcessingFilter" class="com.base22.carbon.authentication.web.AuthenticationProcessingFilter"
		p:authenticationManager-ref="authenticationManager"
		p:authenticationSuccessHandler-ref="restAPIAuthenticationSuccessHandler"
		p:authenticationFailureHandler-ref="restAPIAuthenticationFailureHandler"
	>
		<constructor-arg value="/**" />
	</bean>
	<bean id="restAPIAuthenticationSuccessHandler" class="com.base22.carbon.authentication.web.AuthenticationSuccessHandler"></bean>
    <bean id="restAPIAuthenticationFailureHandler" class="com.base22.carbon.authentication.web.AuthenticationFailureHandler"></bean>
	<!-- === Basic Authentication === -->
	<bean id="restAPIBasicAuthenticationProcessingFilter"
		class="org.springframework.security.web.authentication.www.BasicAuthenticationFilter">
		<constructor-arg ref="authenticationManager" />
		<constructor-arg ref="restAPIBasicAuthenticationEntryPoint" />
	</bean>
	<bean id="restAPIBasicAuthenticationEntryPoint"
		class="com.base22.carbon.authentication.BasicAuthenticationEntryPoint">
		<property name="realmName" value="Carbon LDP"/>
	</bean>
	<!-- === End: Basic Authentication === -->
	<!-- === Token Authentication === -->
	<bean id="tokenService" class="org.springframework.security.core.token.KeyBasedPersistenceTokenService">
		<property name="serverSecret" value="W4KSqaZe8EcVCZF2afW8" />
		<property name="serverInteger" value="9936" />
		<property name="secureRandom" ref="secureRandom" />
	</bean>
	<bean name="secureRandom" class="java.security.SecureRandom" />
	<!-- === End: Token Authentication === -->
	<!-- ====== End: REST API Authentication ====== -->
	
	<!-- ====== Authentication Providers ====== -->
	<bean id="jdbcUsernamePasswordAuthenticationProvider" class="com.base22.carbon.authentication.providers.UsernamePasswordJDBCAuthenticationProvider" init-method="init">
		<property name="jdbcDataSource" ref="securityJDBCDataSource" />
		<property name="agentDetailsDAO" ref="platformAgentDetailsDAO" />
		<property name="privilegeDAO" ref="platformPrivilegeDAO" />
		<property name="groupDAO" ref="platformGroupDAO" />
		<property name="applicationRoleDAO" ref="platformApplicationRoleDAO" />
		<property name="configurationService" ref="configurationService" />
		<property name="ldpService" ref="ldpService" />
	</bean>
	<bean id="jdbcKeyAuthenticationProvider" class="com.base22.carbon.authentication.providers.KeyJDBCAuthenticationProvider" init-method="init">
		<property name="jdbcDataSource" ref="securityJDBCDataSource" />
		<property name="agentDetailsDAO" ref="platformAgentDetailsDAO" />
		<property name="privilegeDAO" ref="platformPrivilegeDAO" />
		<property name="groupDAO" ref="platformGroupDAO" />
		<property name="applicationRoleDAO" ref="platformApplicationRoleDAO" />
		<property name="configurationService" ref="configurationService" />
		<property name="ldpService" ref="ldpService" />
	</bean>
	<bean id="jdbcTokenAuthenticationProvider" class="com.base22.carbon.authentication.providers.TokenJDBCAuthenticationProvider" init-method="init">
		<property name="jdbcDataSource" ref="securityJDBCDataSource" />
		<property name="agentDetailsDAO" ref="platformAgentDetailsDAO" />
		<property name="privilegeDAO" ref="platformPrivilegeDAO" />
		<property name="groupDAO" ref="platformGroupDAO" />
		<property name="applicationRoleDAO" ref="platformApplicationRoleDAO" />
		<property name="configurationService" ref="configurationService" />
		<property name="ldpService" ref="ldpService" />
		
		<property name="tokenService" ref="tokenService" />
	</bean>
	<!-- ====== End: Authentication Providers ====== -->
	
</beans>
