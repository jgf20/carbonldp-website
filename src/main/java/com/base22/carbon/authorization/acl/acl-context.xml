<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
">

	<!-- ====== ACLs ====== -->
	<!-- === ACL Expression Handler === -->
	<bean id="expressionHandler" class="org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler">
		<property name="permissionEvaluator" ref="permissionEvaluator" />
		<property name="permissionCacheOptimizer">
            <bean class="org.springframework.security.acls.AclPermissionCacheOptimizer">
                <constructor-arg ref="aclService"/>
            </bean>
        </property>
	</bean>
	<!-- === End: ACL Expression Handler === -->
	<!-- === End: ACL Permission Evaluator === -->
	<bean id="permissionEvaluator" class="org.springframework.security.acls.AclPermissionEvaluator">
		<constructor-arg ref="aclService"/>
		<property name="permissionFactory" ref="permissionFactory" />
	</bean>
	<!-- === End: ACL Permission Evaluator === -->
	<bean id="permissionFactory" class="com.base22.carbon.authorization.acl.CarbonACLPermissionFactory" />
	<!-- === ACL Service === -->
	<bean id="aclService" class="org.springframework.security.acls.jdbc.JdbcMutableAclService">
		<!-- DataSource -->
		<constructor-arg ref="securityJDBCDataSource" />
		<!-- Lookup Strategy -->
		<constructor-arg>
			<bean class="org.springframework.security.acls.jdbc.BasicLookupStrategy">
				<!-- DataSource -->
				<constructor-arg ref="securityJDBCDataSource" />
				<!-- ACL Cache -->
				<constructor-arg ref="aclCache" />
				<!-- ACL Authorization Strategy -->
				<constructor-arg>
					<bean class="org.springframework.security.acls.domain.AclAuthorizationStrategyImpl">
						<constructor-arg>
			                <bean class="org.springframework.security.core.authority.SimpleGrantedAuthority">
			                    <constructor-arg value="CARBON_ADMINISTRATOR"/>
			                </bean>
			            </constructor-arg>
					</bean>
				</constructor-arg>
				<!-- ACL Permission Granting Strategy -->
				<constructor-arg>
					<bean class="com.base22.carbon.authorization.CarbonPermissionGrantingStrategy">
						<constructor-arg>
							<bean class="com.base22.carbon.authorization.CarbonAuditLogger" />
						</constructor-arg>
						<property name="aclCache" ref="aclCache"></property>
					</bean>
				</constructor-arg>
				<property name="permissionFactory" ref="permissionFactory" />
			</bean>
		</constructor-arg>
		<!-- ACL Cache -->
		<constructor-arg ref="aclCache" />
		<property name="classIdentityQuery" value="SELECT @@IDENTITY"/>
		<property name="sidIdentityQuery" value="SELECT @@IDENTITY"/>
	</bean>
	<!-- === End: ACL Service === -->
	<!-- === ACL Cache === -->
	<bean id="aclCache" class="org.springframework.security.acls.domain.EhCacheBasedAclCache">
        <constructor-arg>
            <bean class="org.springframework.cache.ehcache.EhCacheFactoryBean">
                <property name="cacheManager">
                    <bean class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean"/>
                </property>
                <property name="cacheName" value="aclCache"/>
            </bean>
        </constructor-arg>
    </bean>
    <!-- === End: ACL Cache === -->
	<!-- ====== End: ACLs ====== -->
</beans>
